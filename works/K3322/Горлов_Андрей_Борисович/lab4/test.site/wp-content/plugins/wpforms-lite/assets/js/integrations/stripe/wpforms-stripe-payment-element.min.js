var WPFormsStripePaymentElement=window.WPFormsStripePaymentElement||function(r,i,d){let s;const m={stripe:null,forms:{},init(){m.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale,betas:["elements_enable_deferred_intent_beta_1"]}),d(r).on("wpformsReady",function(){d(".wpforms-stripe form").each(m.setupStripeForm).on("wpformsConvFormsFieldActivationAfter",m.convFormsFieldActivationAfter)}),d(r).on("wpformsBeforePageChange",m.pageChange).on("wpformsAmountTotalCalculated",m.updateElementsTotalAmount).on("wpformsProcessConditionalsField",function(e,o,r,t,n){m.processConditionalsField(o,r,t,n)})},initializeFormsDefaultObject(){console.warn('WARNING! Function "WPFormsStripePaymentElement.initializeFormsDefaultObject()" has been deprecated, please use the "WPFormsStripePaymentElement.initializeFormDefaultObject( formId )" function instead!'),d(".wpforms-stripe form").each(function(){m.initializeFormDefaultObject(d(this).data("formid"))})},initializeFormDefaultObject(e){m.forms[e]={elements:null,paymentElement:null,elementsModified:!1,linkElement:null,linkEmail:"",linkDestroyed:!1,paymentType:"",lockedPageToSwitch:0,paymentMethodId:"",total:""}},setupStripeForm(){var e,o=d(this),r=o.data("formid");void 0===m.forms[r]&&(m.initializeFormDefaultObject(r),(r=o.find(".wpforms-field-stripe-credit-card")).find(".wpforms-field-row").length)&&(e=o.data("validator"))&&(s=e.settings.submitHandler,e.settings.submitHandler=m.submitHandler,o.on("wpformsAjaxSubmitActionRequired",m.confirmPaymentActionCallback),r.hasClass("wpforms-conditional-field")||m.setupPaymentElement(o))},async confirmPaymentActionCallback(e,o){if(o.success&&o.data.action_required){const n=d(this);var r=new URL(i.location.href),t=n.data("formid");await m.stripe.confirmPayment({clientSecret:o.data.payment_intent_client_secret,confirmParams:{return_url:r.toString(),payment_method:m.forms[t].paymentMethodId},redirect:"if_required"}).then(function(e){m.handleConfirmPayment(n,e)})}},handleConfirmPayment(e,o){var r;o.error?m.displayStripeError(e,o.error.message):(r=e.data("formid"),o.paymentIntent&&"succeeded"===o.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+o.paymentIntent.id+'">'),e.append('<input type="hidden" class="wpforms-stripe-payment-link-email" name="wpforms[payment_link_email]" value="'+m.forms[r].linkEmail+'">'),wpforms.formSubmitAjax(e)):m.formAjaxUnblock(e))},setupPaymentElement(e){var o=e.data("formid");d.isEmptyObject(m.forms)&&m.initializeFormDefaultObject(o),m.forms[o].paymentElement||(m.forms[o].elements=m.stripe.elements({currency:wpforms.getCurrency().code.toLowerCase(),mode:"payment",amount:7777777,loader:"always",locale:wpforms_stripe.data.element_locale,appearance:m.getElementAppearanceOptions(e)}),m.initializePaymentElement(e),m.linkEmailMappedFieldTriggers(e),wpforms.amountTotalCalc(e),m.updatePaymentElementStylesModern(e),WPFormsUtils.triggerEvent(d(r),"wpformsStripePaymentElementInitialized",[e,m.forms]))},processConditionalsField(e,o,r,t){var n=d("#wpforms-form-"+e),i=n.find(".wpforms-field-stripe-credit-card"),r=r&&"hide"===t||!r&&"hide"!==t;!i.length||i.data("field-id").toString()!==o||m.forms[e].paymentElement||r||m.setupPaymentElement(n)},getElementAppearanceOptions(e){var o,r,t=m.getCustomAppearanceOptions();return d.isEmptyObject(t)?(r=e.find(".wpforms-stripe-credit-card-hidden-input"),o=!(e=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row")).hasClass("wpforms-sublabel-hide"),r={borderColor:m.getCssPropertyValue(r,"--field-border")||m.getCssPropertyValue(r,"border-color"),borderRadius:m.getCssPropertyValue(r,"border-radius"),fontSize:m.getCssPropertyValue(r,"font-size"),colorPrimary:m.getCssPropertyValue(r,"--primary-color")||m.getCssPropertyValue(r,"color"),colorText:m.getCssPropertyValue(r,"--secondary-color")||m.getCssPropertyValue(r,"color"),colorTextPlaceholder:m.getCssPropertyValue(r,"--secondary-color-50")||WPFormsUtils.cssColorsUtils.getColorWithOpacity(m.getCssPropertyValue(r,"color"),"0.5"),colorBackground:m.getCssPropertyValue(r,"--background-color")||m.getCssPropertyValue(r,"background-color"),fontFamily:m.getCssPropertyValue(r,"font-family"),focusColor:m.getCssPropertyValue(r,"--accent-color")||m.getCssPropertyValue(r,"color"),errorColor:"#990000"},i.WPForms&&WPForms.FrontendModern&&(r.colorPrimary=WPForms.FrontendModern.getSolidColor(r.colorPrimary)),{theme:"none",labels:e.data("sublabel-position"),sublabelHide:o,variables:{colorPrimary:r.colorPrimary,colorBackground:r.colorBackground,colorText:r.colorText,colorDanger:r.errorColor,fontFamily:r.fontFamily,spacingUnit:"4px",spacingGridRow:"8px",fontSizeSm:"13px",fontWeightNormal:"400",borderRadius:r.borderRadius,colorTextPlaceholder:r.colorTextPlaceholder,colorIcon:r.colorText,focusColor:r.focusColor,borderColorWithOpacity:WPFormsUtils.cssColorsUtils.getColorWithOpacity(r.colorPrimary,"0.1")},rules:{".Input--invalid":{color:r.colorText,borderColor:"#cc0000"},".Input":{border:"none",borderRadius:r.borderRadius,boxShadow:"0 0 0 1px "+r.borderColor,fontSize:r.fontSize,padding:"12px 14px",lineHeight:parseInt(r.fontSize,10)+5+"px",transition:"none",color:r.colorText,backgroundColor:r.colorBackground},".Input:focus, .Input:hover":{border:"none",boxShadow:"0 0 0 2px "+r.focusColor,outline:"none"},".Label":{fontFamily:r.fontFamily,lineHeight:o?"1.3":"0",opacity:Number(o),color:r.colorPrimary},".CheckboxInput, .CodeInput, .PickerItem":{border:"1px solid "+r.borderColor},".Tab, .Block":{border:"1px solid "+r.borderColor,borderRadius:r.borderRadius,color:r.colorText},".TabLabel, .TabIcon":{color:r.colorText},".Tab--selected":{borderColor:"#999999",color:r.colorText},".Action":{marginLeft:"6px"},".Action, .MenuAction":{border:"none",backgroundColor:"transparent"},".Action:hover, .MenuAction:hover":{border:"none",backgroundColor:"transparent"},".Error, .RedirectText":{color:r.errorColor},".TabIcon--selected":{fill:r.colorText}}}):t},getCustomAppearanceOptions(){return"object"==typeof i.wpformsStripePaymentElementAppearance?i.wpformsStripePaymentElementAppearance:d.isEmptyObject(wpforms_stripe.data.element_appearance)?{}:wpforms_stripe.data.element_appearance},getCssPropertyValue(e,o){try{return e.css(o)}catch(e){return""}},initializePaymentElement(o,e=""){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),t=o.data("formid");m.forms[t].paymentElement&&m.forms[t].paymentElement.destroy(),m.forms[t].paymentElement=m.forms[t].elements.create("payment",{defaultValues:{billingDetails:{email:e}}}),m.mountPaymentElement(o),m.forms[t].paymentElement.on("change",function(e){m.forms[t].paymentType=e.value.type,r.data("link-email")||("google_pay"===e.value.type||"apple_pay"===e.value.type?(m.forms[t].linkElement.destroy(),m.forms[t].linkDestroyed=!0):m.forms[t].linkDestroyed&&(m.initializeLinkAuthenticationElement(o),m.forms[t].linkDestroyed=!1)),r.data("type",e.value.type),e.empty?(r.data("completed",!1),r.find("label.wpforms-error").toggle("card"===e.value.type)):(m.forms[t].elementsModified=!0,e.complete?(r.data("completed",!0),m.hideStripeFieldError(o)):r.data("completed",!1))}),m.forms[t].paymentElement.on("loaderror",function(e){m.displayStripeLoadError(o,e.error.message)})},mountPaymentElement(e){var e=e.data("formid"),o="#wpforms-field-stripe-payment-element-"+e;m.forms[e].paymentElement.mount(o)},linkEmailMappedFieldTriggers(e){const o=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row");var r=m.getMappedLinkEmailField(e);if(r){const t=e.data("formid");r.on("change",function(){m.forms[t].linkEmail=d(this).val(),o.data("completed")||m.initializePaymentElement(e,d(this).val())})}else o.data("linkCompleted",!1),m.initializeLinkAuthenticationElement(e)},getMappedLinkEmailField(e){var o=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row").data("link-email");return o?(e=e.data("formid"),d(`#wpforms-${e}-field_`+o)):null},initializeLinkAuthenticationElement(o){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),t=o.data("formid");m.forms[t].linkElement=m.forms[t].elements.create("linkAuthentication"),m.mountLinkElement(o),m.forms[t].linkElement.on("change",function(e){e.empty||(m.forms[t].elementsModified=!0,e.complete?(void 0!==e.value.email&&(m.forms[t].linkEmail=e.value.email),r.data("linkCompleted",!0),m.hideStripeFieldError(o)):r.data("linkCompleted",!1))}),m.forms[t].linkElement.on("loaderror",function(e){m.displayStripeLoadError(o,e.error.message)})},mountLinkElement(e){var e=e.data("formid"),o="#wpforms-field-stripe-link-element-"+e;m.forms[e].linkElement.mount(o)},submitHandler(e){var e=d(e),o=e.find(".wpforms-field-stripe-credit-card"),r=o.find(".wpforms-field-row"),t=e.validate().form(),n=e.data("formid"),i=r.data("required"),a=-1!==["google_pay","apple_pay"].indexOf(m.forms[n].paymentType),n=!r.data("link-email")&&m.forms[n].elementsModified||r.data("completed")||a;let l=!1;o.hasClass("wpforms-conditional-hide")||(l=i||n&&!i),t&&l?(e.find(".wpforms-submit").prop("disabled",!0),e.find(".wpforms-submit-spinner").show(),m.createPaymentMethod(e)):t?s(e):(e.find(".wpforms-submit").prop("disabled",!1),e.validate().cancelSubmit=!0)},updateElementsTotalAmount(e,o,r){var t;r&&(o=o.data("formid"),m.forms[o])&&m.forms[o].elements&&(t=wpforms.getCurrency(),m.forms[o].total=r,m.forms[o].elements.update({amount:parseInt(wpforms.numberFormat(r,t.decimals,"",""),10)}))},async createPaymentMethod(r){const t=r.data("formid");m.forms[t].total?await m.stripe.createPaymentMethod({elements:m.forms[t].elements}).then(function(e){var o;e.error?(o=["incomplete_email","email_invalid","incomplete_number","invalid_number","incomplete_expiry","invalid_expiry_year_past","invalid_expiry_year","incomplete_cvc","incomplete_name","incomplete_phone_number","empty_phone_number","invalid_postal_code"].includes(e.error.code)?"":e.error.message,m.displayStripeFieldError(r,o)):(m.forms[t].paymentMethodId=e.paymentMethod.id,r.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+m.forms[t].paymentMethodId+'">'),s(r))}):s(r)},formAjaxUnblock(e){var o=e.find(".wpforms-submit"),r=o.data("submit-text");r&&o.text(r),o.prop("disabled",!1),o.removeClass("wpforms-disabled"),e.closest(".wpforms-container").css("opacity",""),e.find(".wpforms-submit-spinner").hide()},displayStripeError(e,o){wpforms.clearFormAjaxGeneralErrors(e),wpforms.displayFormAjaxErrors(e,o),m.formAjaxUnblock(e)},displayStripeFieldError(e,o){var r=e.find(".wpforms-stripe-credit-card-hidden-input").attr("name"),t=e.find(".wpforms-field-stripe-credit-card"),n={};o&&(n[r]=o),wpforms.displayFormAjaxFieldErrors(e,n),!t.is(":visible")&&0<e.find(".wpforms-page-indicator-steps").length&&wpforms.setCurrentPage(e,{}),wpforms.scrollToError(t),m.formAjaxUnblock(e)},hideStripeFieldError(e){e.find(".wpforms-field-stripe-credit-card .wpforms-error").hide()},displayStripeLoadError(e,o){o=wpforms_stripe.i18n.element_load_error+"<br /> "+o,m.displayStripeError(e,o)},pageChange(e,o,r,t){var n=r.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),i=r.data("formid");n.length&&-1!==["card","link"].indexOf(m.forms[i].paymentType)&&(m.forms[i].elementsModified||"card"!==m.forms[i].paymentType||(m.forms[i].paymentElement.unmount(),m.mountPaymentElement(r),n.data("link-email"))||(m.forms[i].linkElement.unmount(),m.mountLinkElement(r)),!n.is(":visible")||!n.data("required")&&!m.forms[i].elementsModified||m.forms[i].lockedPageToSwitch&&m.forms[i].lockedPageToSwitch!==o||"prev"===t||(t=void 0===n.data("linkCompleted")||n.data("linkCompleted"),n.data("completed")&&t?m.hideStripeFieldError(r):(m.forms[i].lockedPageToSwitch=o,m.displayStripeFieldError(r,wpforms_stripe.i18n.empty_details),e.preventDefault())))},convFormsFieldActivationAfter(e,o){m.setupPaymentElement(o.$el.closest("form"))},getCssVar(e,o){return console.warn('WARNING! Function "WPFormsStripePaymentElement.getCssVar()" has been deprecated, please use the "WPForms.FrontendModern.getCssVar()" function instead!'),WPForms?.FrontendModern?.getCssVar()},updatePaymentElementStylesModern(e){var o;d.isEmptyObject(m.getCustomAppearanceOptions())&&i.WPForms&&WPForms.FrontendModern&&e&&0!==e.length&&!e.closest(".wpforms-container").hasClass("wpforms-lead-forms-container")&&(o=e.data("formid"),m.forms[o])&&(o=m.forms[o].elements,e=WPForms.FrontendModern.getCssVars(e),m.updateFormElementsAppearance(o,e))},updateFormElementsAppearance(e,o){var r,t;e&&e._commonOptions&&(r=e._commonOptions.appearance,o["field-size-padding-v"]=(parseInt(o["field-size-input-height"],10)-parseInt(o["field-size-font-size"],10)-6)/2+"px",r.variables.spacingGridRow=o["field-size-input-spacing"],r.variables.spacingGridColumn="20px",r.variables.spacingTab="10px",r.variables.colorText=WPForms.FrontendModern.getSolidColor(o["field-text-color"]),t=WPFormsUtils.cssColorsUtils.isTransparentColor(o["field-background-color"])?o["field-menu-color"]:o["field-background-color"],t=WPForms.FrontendModern.getSolidColor(t),r.rules={".Input":{border:o["field-border-size"]+" "+o["field-border-style"]+" "+o["field-border-color"],borderRadius:o["field-border-radius"],padding:o["field-size-padding-v"]+" "+o["field-size-padding-h"],fontSize:o["field-size-font-size"],lineHeight:o["field-size-font-size"],backgroundColor:o["field-background-color"],boxShadow:"none",outline:"none"},".Input:focus":{backgroundColor:t,borderColor:o["button-background-color"],borderStyle:"solid",boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".Input--invalid":{borderColor:o["label-error-color"],boxShadow:"none",color:r.variables.colorText,outline:"none"},".Input--invalid:focus":{borderColor:o["label-error-color"],boxShadow:"0 0 0 1px "+o["label-error-color"],outline:"none"},".Input::placeholder":{color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5"),fontSize:o["field-size-font-size"]},".CheckboxInput":{border:"1px solid "+o["field-border-color"],backgroundColor:o["field-background-color"]},".CheckboxInput--checked":{borderColor:o["button-background-color"],backgroundColor:o["button-background-color"]},".CodeInput":{border:"1px solid "+o["field-text-color"],backgroundColor:t},".CodeInput:focus":{borderWidth:"2px",boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".CodeInput:disabled":{borderColor:WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5")},".Label":{fontSize:o["label-size-sublabel-font-size"],margin:`0 0 ${o["field-size-sublabel-spacing"]} 0`,color:o["label-sublabel-color"],opacity:Number(Boolean(r?.sublabelHide)),lineHeight:r?.sublabelHide?"inherit":"0"},".Error":{fontSize:o["label-size-sublabel-font-size"],margin:o["field-size-sublabel-spacing"]+" 0 0 0",color:o["label-error-color"]},".Tab":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),borderRadius:o["field-border-radius"],backgroundColor:"transparent",boxShadow:"none",marginTop:"0"},".Tab:focus":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.5"),boxShadow:"0 0 0 3px "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.25"),outline:"none"},".Tab:hover":{border:"1px solid "+o["field-border-color"]},".Tab--selected":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"],backgroundColor:o["field-background-color"]},".Tab--selected:hover":{borderColor:o["button-background-color"]},".Tab--selected:focus":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"]},".TabLabel":{color:o["field-text-color"]},".TabIcon":{fill:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.75")},".TabIcon--selected":{fill:o["field-text-color"]},".TabIcon:hover":{color:o["field-text-color"],fill:o["field-text-color"]},".TabLabel--selected":{color:o["button-background-color"]},".Block":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),backgroundColor:t,borderRadius:o["field-border-radius"],boxShadow:"none"},".AccordionItem":{backgroundColor:t,paddingLeft:0,paddingRight:0,color:o["field-text-color"]},".PickerItem,":{backgroundColor:t}},e.update({appearance:r}))}};return m}(document,window,jQuery);WPFormsStripePaymentElement.init();